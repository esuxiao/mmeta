---
title: 'UAT SingleTable class: Jeffery prior, OR, Samanov '
author: "Jiajie Chen, Xiao Su"
date: "`r Sys.Date()`"
output: word_document
---

## Enviroment setup



```{r}
rm(list = ls())
knitr::opts_chunk$set(echo = TRUE)
source_all_files <- function(path){
  files <- list.files(path)
  for(i in 1:length(files)){
    full_path <- paste(path, files[i],sep="")
    source(full_path)
  }
}
### Load the new version
library(ggplot2)
new_verrsion_path <- 'G:/My Drive/ShareFolder/mmeta_package/working/new_mmeta_dev/func_dev/'
source_all_files(new_verrsion_path)


```

## Test sampling  method

### Create object

* specify data (y1, n1, y2, n2)
* specify parameters (a1, b1, a2, b2, rho)
* specify model (Sarmanov/Independent)
* Specify measure(OR/RR/RD)
```{r}
single_table_obj_samling <- SingleTable.create(a1=0.5, b1=0.5, 
                                               a2=0.5, b2=0.5,
                              rho=0.5, y1=40, n1=96, y2=49, n2=109,
                              model="Sarmanov",measure="OR")
```

### model fit

default
```{r}
single_table_obj_samling <- SingleTable.modelFit(single_table_obj_samling, method = 'sampling')
```

control list can be specified to control the fitting process:
* n_samples: number of posterior samples; Defualt is 5000.

* mcmc_initial: initial values for (p1, p2) in MCMC; Default is  c(0.5, 0.5)

* upper_bound: upper bound for the measure. Default is 100.

* lower_bound: lower bound for the measure. For RD, default is -1. For RR/OR, defualt is 0.

* num_grids: number of grids to calculate density; The defualt is 20498.



set number of posterior samples as 3000 (default is 5000)
```{r}
single_table_obj_samling <- SingleTable.modelFit(single_table_obj_samling, method = 'sampling', control = list(n_sample = 3000))
```


set initial values for MCMC is c(0.2, 0,4) (default is c(0.5,0.5))
```{r}
single_table_obj_samling <- SingleTable.modelFit(single_table_obj_samling, method = 'sampling', control = list(mcmc_initial = c(0.2,0.4)))
```


set upper bound for the measure is 20( default is 100)
```{r}
single_table_obj_samling <- SingleTable.modelFit(single_table_obj_samling, method = 'sampling', control = list(upper_bound = 20))
```


### Summary

```{r}
single_table_obj_samling <- SingleTable.summary(single_table_obj_samling, alpha = 0.05)
```

change alpha level to 0.1
```{r}
single_table_obj_samling <- SingleTable.summary(single_table_obj_samling, alpha = 0.1)

```



change digit to 2
```{r}
single_table_obj_samling <- SingleTable.summary(single_table_obj_samling, digit  = 2)

```
not print output
```{r}
single_table_obj_samling <- SingleTable.summary(single_table_obj_samling, verbose = FALSE)

```

## Structure of SingleTable object

```{r}
str(single_table_obj_samling)

```

## overlay density: 

default

```{r}
SingleTable.plot(single_table_obj_samling, type = 'overlay')
```




set xlim between 0 to 4 and add vertical line at x = 1

```{r}
plot_obj <- SingleTable.plot(single_table_obj_samling, type = 'overlay',xlim = c(0,4), add_vertical = 1)
plot_obj 

```

By color instead of line type

```{r}
plot_obj <- SingleTable.plot(single_table_obj_samling, type = 'overlay',
                             xlim = c(0,4), 
                             add_vertical = 1, 
                             by = 'color')
plot_obj 
```

Override the xlab and add title via ggplot2

```{r}
plot_obj <- SingleTable.plot(single_table_obj_samling, type = 'overlay')
plot_obj + xlab('Odds ratio') + ggtitle("Plot of density function") 
```





### Plot side-by-side

default
```{r}
SingleTable.plot(single_table_obj_samling, type = 'side_by_side')

```

set xlim between 0 to 4 and add vertical line at x = 1

```{r}
SingleTable.plot(single_table_obj_samling, type = 'side_by_side',
                 xlim = c(0,4), add_vertical = 1)

```

override xlab and add title via ggplot2
```{r}
plot_obj <- SingleTable.plot(single_table_obj_samling, type = 'side_by_side',
                 xlim = c(0,4), add_vertical = 1)

plot_obj + xlab('Odds ratio') + ggtitle("Plot of density function") 
```



## Test eaxct  method

### Create object

* specify data (y1, n1, y2, n2)

* specify parameters (a1, b1, a2, b2, rho)

* specify model (Sarmanov/Independent)

* Specify measure(OR/RR/RD)
```{r}
single_table_obj_exact <- SingleTable.create(a1=0.5, b1=0.5, 
                                               a2=0.5, b2=0.5,
                              rho=0.5, y1=40, n1=96, y2=49, n2=109,
                              model="Sarmanov",measure="OR")
```

### model fit

default
```{r}
single_table_obj_exact <- SingleTable.modelFit(single_table_obj_exact, method = 'exact')
```

control list can be specified to control the fitting process:
* n_samples: number of posterior samples; Defualt is 5000.

* mcmc_initial: initial values for (p1, p2) in MCMC; Default is  c(0.5, 0.5)

* upper_bound: upper bound for the measure. Default is 100.

* lower_bound: lower bound for the measure. For RD, default is -1. For RR/OR, defualt is 0.

* num_grids: number of grids to calculate density; The defualt is 20498.



set number of posterior samples as 3000 (default is 5000)
```{r}
single_table_obj_exact <- SingleTable.modelFit(single_table_obj_exact, method = 'exact', 
                                               control = list(n_sample = 3000))
```


set initial values for MCMC is c(0.2, 0,4) (default is c(0.5,0.5))
```{r}
single_table_obj_exact <- SingleTable.modelFit(single_table_obj_exact, method = 'exact',
                                               control = list(mcmc_initial = c(0.2,0.4)))
```


set upper bound for the measure is 20( default is 100)
```{r}
single_table_obj_exact <- SingleTable.modelFit(single_table_obj_exact, method = 'exact', 
                                                 control = list(upper_bound = 20))
```


### Summary

```{r}
single_table_obj_exact <- SingleTable.summary(single_table_obj_exact, alpha = 0.05)
```

change alpha level to 0.1
```{r}
single_table_obj_exact <- SingleTable.summary(single_table_obj_exact, alpha = 0.1)

```



change digit to 2
```{r}
single_table_obj_exact <- SingleTable.summary(single_table_obj_exact, digit  = 2)

```
not print output
```{r}
single_table_obj_exact <- SingleTable.summary(single_table_obj_exact, verbose = FALSE)

```

## Structure of SingleTable object

```{r}
str(single_table_obj_exact)

```

## overlay density: 

default

```{r}
SingleTable.plot(single_table_obj_exact, type = 'overlay')
```




set xlim between 0 to 4 and add vertical line at x = 1

```{r}
plot_obj <- SingleTable.plot(single_table_obj_exact, type = 'overlay',xlim = c(0,4), add_vertical = 1)
plot_obj 

```

By color instead of line type

```{r}
plot_obj <- SingleTable.plot(single_table_obj_exact, type = 'overlay',
                             xlim = c(0,4), 
                             add_vertical = 1, 
                             by = 'color')
plot_obj 
```

Override the xlab and add title via ggplot2

```{r}
plot_obj <- SingleTable.plot(single_table_obj_exact, type = 'overlay')
plot_obj + xlab('Odds ratio') + ggtitle("Plot of density function") 
```





### Plot side-by-side

default
```{r}
SingleTable.plot(single_table_obj_exact, type = 'side_by_side')

```

set xlim between 0 to 4 and add vertical line at x = 1

```{r}
SingleTable.plot(single_table_obj_exact, type = 'side_by_side',
                 xlim = c(0,4), add_vertical = 1)

```

override xlab and add title via ggplot2
```{r}
plot_obj <- SingleTable.plot(single_table_obj_exact, type = 'side_by_side',
                 xlim = c(0,4), add_vertical = 1)

plot_obj + xlab('Odds ratio') + ggtitle("Plot of density function") 
```

